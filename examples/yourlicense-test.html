<!DOCTYPE html>
<meta charset="utf-8">

<head>
    <meta charset="utf-8">
    <title>Modular Norms - YOURLICENSE</title>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <script   src="https://code.jquery.com/jquery-3.2.1.min.js"
              integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
              crossorigin="anonymous">
    </script>
    <script   src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
              integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
              crossorigin="anonymous">
    </script>
</head>

<body>
  <h2>Modular Norm Model Demo</h2>
  <label>   Subject ID:  </label>
  <div>
    <textarea id="studentid" class="textarea"></textarea>
  </div>
  <label> Selection (populated automatially based on model interactions): </label>
  <div id="textarea"></div>
  <div></div>
  <button id="opener" class="button">Solve</button>

  <div>
    <h2>Example Legal Text</h2>
    <p>
        <b>Your Public License (YPL) v1.0</b>
          <p> 4. You may reproduce and distribute copies of the Work or Derivative Works thereof in any medium, with or without modifications, and in Source or Object form, provided that You meet the following condition:</p>
          <p> a. You must retain, in the Source form of any Derivative Works that You distribute, all copyright, patent, trademark, and attribution notices from the Source form of the Work</p>
    </p>
    <h2>Compliance Scenario</h2>
    <p>
      <b>Scenario:</b>
      <ul>
        <li> Sam is using a YourPublicLicense v1.0 licensed codebase in his organization. He wants to modify the codebase and distribute it to his customers. The original codebase has several copyright, patent, trademark, and attribution notices.
      </ul>
      <b>Compliance Question:</b>
      <ul>
        <li> In his modified copy, Sam excluded trademark notices from the original source code. Is Sam compliant with YPL v1.0?
      </ul>
      <b>Answer choices:</b>
      <ol>
        <li> Yes, Sam is compliant with YPL v1.0
        <li> No, Sam in not compliant with YPL v1.0
        <li> Need more information
      </ol>
    </p>

    <h2>Modular Norm Model</h2>
      <p>
        <b>How to use:</b>
        <ol>
        <li> Determine the most relevant norm for a given scenario
        <ul>
          <li> Hover over Duties and Rights to read relevant text
        </ul>
        <li> Trace <b> activating </b> situations for the norm in Step 1
          <ul>
            <li> Follow links to other norms and situations
            <li> Assign truth values of situations with respect to the scenario and the question
          </ul>
        <li> Trace <b> satisfying </b> situations for the norm in Step 1
          <ul>
            <li> Assign truth values of situations with respect to the scenario and the question
          </ul>
        <li> Hit the SOLVE button.
        <li> Note the color of the situation containing the norm in Step 1.
          <ul>
            <li> Containing Situation --> Green, then scenario is Compliant
            <li> Containing Situation --> Red, then scenario is Non-Compliant
            <li> Containing Situation --> Yellow, then scenario Needs More Information.
          </ul>
      </p>
  </div>

    <div id="main">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: G Pages: 1 -->
<svg id="mainsvg" width="722pt" height="275pt"
 viewBox="0.00 0.00 722.00 275.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 271)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-271 718,-271 718,4 -4,4"/>
<g id="clust1" class="cluster"><title>clusterSS_YPL4a</title>
<polygon fill="#FFFFFF" stroke="black" points="8,-8 8,-259 398,-259 398,-8 8,-8"/>
<text text-anchor="middle" x="203" y="-15.8" font-family="Times New Roman,serif" font-size="14.00">SS_YPL4a</text>
</g>
<g id="clust2" class="cluster"><title>clusterSS_YPL4</title>
<polygon fill="#FFFFFF" stroke="black" points="406,-16 406,-259 706,-259 706,-16 406,-16"/>
<text text-anchor="middle" x="556" y="-23.8" font-family="Times New Roman,serif" font-size="14.00">SS_YPL4</text>
</g>
<!-- YPL4a -->
<g id="node1" class="node"><title>YPL4a</title>
<g id="a_node1"><a title="4(a) You must retain, in the Source form of any Derivative Works that You distribute, all copyright, patent, trademark, and attribution notices from the Source form of the Work.">
<polygon fill="#FFFFFF" stroke="black" points="303,-251 230.412,-216.5 375.588,-216.5 303,-251"/>
<text text-anchor="middle" x="303" y="-224.3" font-family="Times New Roman,serif" font-size="14.00">YPL4a</text>
</a>
</g>
</g>
<!-- YPL4a_1 -->
<g id="node2" class="node"><title>YPL4a_1</title>
<polygon fill="#FFFFFF" stroke="black" points="390,-152.5 216,-152.5 216,-39.5 390,-39.5 390,-152.5"/>
<text text-anchor="middle" x="303" y="-137.3" font-family="Times New Roman,serif" font-size="14.00">[You retained] in the Source</text>
<text text-anchor="middle" x="303" y="-122.3" font-family="Times New Roman,serif" font-size="14.00"> form of any Derivative</text>
<text text-anchor="middle" x="303" y="-107.3" font-family="Times New Roman,serif" font-size="14.00"> Works that You distribute,</text>
<text text-anchor="middle" x="303" y="-92.3" font-family="Times New Roman,serif" font-size="14.00"> all copyright, patent,</text>
<text text-anchor="middle" x="303" y="-77.3" font-family="Times New Roman,serif" font-size="14.00"> trademark, and attribution</text>
<text text-anchor="middle" x="303" y="-62.3" font-family="Times New Roman,serif" font-size="14.00"> notices from the Source</text>
<text text-anchor="middle" x="303" y="-47.3" font-family="Times New Roman,serif" font-size="14.00"> form of the Work</text>
</g>
<!-- YPL4a_1&#45;&gt;YPL4a -->
<g id="edge1" class="edge"><title>YPL4a_1&#45;&gt;YPL4a</title>
<path fill="none" stroke="black" d="M303,-152.509C303,-171.459 303,-191.509 303,-206.028"/>
<polygon fill="black" stroke="black" points="299.5,-206.36 303,-216.36 306.5,-206.36 299.5,-206.36"/>
<text text-anchor="middle" x="325.5" y="-175.3" font-family="Times New Roman,serif" font-size="14.00">satisfies</text>
</g>
<!-- YPL4a_2 -->
<g id="node3" class="node"><title>YPL4a_2</title>
<polygon fill="#FFFFFF" stroke="black" points="198,-122.5 16,-122.5 16,-69.5 198,-69.5 198,-122.5"/>
<text text-anchor="middle" x="107" y="-107.3" font-family="Times New Roman,serif" font-size="14.00">[You intend to reproduce and</text>
<text text-anchor="middle" x="107" y="-92.3" font-family="Times New Roman,serif" font-size="14.00"> distribute copies of the</text>
<text text-anchor="middle" x="107" y="-77.3" font-family="Times New Roman,serif" font-size="14.00"> Work or Derivative Works]</text>
</g>
<!-- YPL4a_2&#45;&gt;YPL4a -->
<g id="edge2" class="edge"><title>YPL4a_2&#45;&gt;YPL4a</title>
<path fill="none" stroke="black" d="M145.723,-122.684C185.086,-148.792 244.886,-188.455 278.263,-210.593"/>
<polygon fill="black" stroke="black" points="276.669,-213.735 286.937,-216.346 280.538,-207.902 276.669,-213.735"/>
<text text-anchor="middle" x="264.5" y="-175.3" font-family="Times New Roman,serif" font-size="14.00">activates</text>
</g>
<!-- YPL4 -->
<g id="node4" class="node"><title>YPL4</title>
<g id="a_node4"><a title="4. You may reproduce and distribute copies of the Work or Derivative Works thereof in any medium, with or without modifications, and in Source or Object form, provided that You meet the following condition:">
<polygon fill="#FFFFFF" stroke="black" points="592.988,-228 495.506,-251 495.506,-205 592.988,-228"/>
<text text-anchor="middle" x="528" y="-224.3" font-family="Times New Roman,serif" font-size="14.00">YPL4</text>
</a>
</g>
</g>
<!-- YPL4_3 -->
<g id="node5" class="node"><title>YPL4_3</title>
<polygon fill="#FFFFFF" stroke="black" points="697.5,-145 512.5,-145 512.5,-47 697.5,-47 697.5,-145"/>
<text text-anchor="middle" x="605" y="-129.8" font-family="Times New Roman,serif" font-size="14.00">[You reproduced and</text>
<text text-anchor="middle" x="605" y="-114.8" font-family="Times New Roman,serif" font-size="14.00"> distributed] copies of the</text>
<text text-anchor="middle" x="605" y="-99.8" font-family="Times New Roman,serif" font-size="14.00"> Work or Derivative Works</text>
<text text-anchor="middle" x="605" y="-84.8" font-family="Times New Roman,serif" font-size="14.00"> thereof in any medium, with</text>
<text text-anchor="middle" x="605" y="-69.8" font-family="Times New Roman,serif" font-size="14.00"> or without modifications,</text>
<text text-anchor="middle" x="605" y="-54.8" font-family="Times New Roman,serif" font-size="14.00"> and in Source or Object form</text>
</g>
<!-- YPL4_3&#45;&gt;YPL4 -->
<g id="edge3" class="edge"><title>YPL4_3&#45;&gt;YPL4</title>
<path fill="none" stroke="black" d="M579.292,-145.086C571.706,-158.77 563.227,-173.594 555,-187 551.113,-193.333 546.679,-200.079 542.543,-206.191"/>
<polygon fill="black" stroke="black" points="539.565,-204.345 536.796,-214.572 545.338,-208.305 539.565,-204.345"/>
<text text-anchor="middle" x="585.5" y="-175.3" font-family="Times New Roman,serif" font-size="14.00">satisfies</text>
</g>
<!-- YPL4_4 -->
<g id="node6" class="node"><title>YPL4_4</title>
<polygon fill="#FFFFFF" stroke="black" points="494,-114 414,-114 414,-78 494,-78 494,-114"/>
<text text-anchor="middle" x="454" y="-92.3" font-family="Times New Roman,serif" font-size="14.00">SS_YPL4a</text>
</g>
<!-- YPL4_4&#45;&gt;YPL4a -->
<g id="edge5" class="edge"><title>YPL4_4&#45;&gt;YPL4a</title>
<path fill="none" stroke="grey" stroke-dasharray="5,2" d="M439.28,-114.428C430.745,-124.186 419.444,-136.549 405.358,-149.786"/>
<polygon fill="grey" stroke="grey" points="402.74,-147.438 397.739,-156.778 407.473,-152.596 402.74,-147.438"/>
</g>
<!-- YPL4_4&#45;&gt;YPL4 -->
<g id="edge4" class="edge"><title>YPL4_4&#45;&gt;YPL4</title>
<path fill="none" stroke="black" d="M463.827,-114.263C476.502,-136.531 498.66,-175.457 513.332,-201.233"/>
<polygon fill="black" stroke="black" points="510.379,-203.12 518.368,-210.079 516.463,-199.657 510.379,-203.12"/>
<text text-anchor="middle" x="528.5" y="-175.3" font-family="Times New Roman,serif" font-size="14.00">activates</text>
</g>
</g>
</svg>


    </div>
    <script>
        var jsonData = [];
        var jsonResult = [];

        // This function will execute on load
        $(document).ready(function() {

        });

        // Builds the JSON data object
        function updateJSON(id, status) {

            //check if norm
            var delimited = id.split('_');
            var isNorm = false;
            if (delimited[1] == null) {
                isNorm = true; // Is a norm
            } else {
                isNorm = false; // not a norm
            }

            if (!isNorm) {
                var exist = false;
                $.each(jsonData, function(key, val) {
                    if (val.id == id) {
                        val.satisfied = status;
                        exist = true;
                    }
                });
                if (exist == false) {
                    item = {};
                    item["id"] = id;
                    item["satisfied"] = status;
                    jsonData.push(item);
                }

            } else { // this is a norm
                var exist = false;
                $.each(jsonData, function(key, val) {
                    if (val.id == id) {
                        val.compliance = status;
                        exist = true;
                    }
                });
                if (exist == false) {
                    item = {};
                    item["id"] = id;
                    item["compliance"] = status;
                    jsonData.push(item);
                }
            }

            $("#textarea").text(JSON.stringify(jsonData));

        }

        //Respponds to the button press event
        $("#opener").click(function() {
          if ($("#studentid").val() != ""){
            $("#opener").css('background-color','grey');
            $("#opener").prop('disabled', true);
            //accessURL = "http://localhost:4567/assert/6/" + $("#studentid").val() + ""
            //accessURL = "http://137.48.191.24:4567/assert/6/" + $("#studentid").val() + ""
            accessURL = "https://norm-server-test.herokuapp.com/assert/6/" + $("#studentid").val() + ""
            console.log(accessURL);
            $.ajax(accessURL, {
                method: 'POST',
                data: JSON.stringify(jsonData),
                crossDomain: true
            }).then(function(data) {
                console.log(data);
                updateSVG(data);
                $("#opener").prop('disabled', false);
                $("#opener").css('background-color','#4CAF50');
                //alert("Done! Review results")
            });
          } else{
            alert("Please enter a valid Experiment Subject ID");
          }
        });

        function updateSVG (data){
          $.each(data, function(key, val) {
              if (val.id != null) {
                  $("title").each(function(index, element) {
                    if ($(this).text() == val.id){
                       polygon = $(this).parent().children("polygon").first();
                       if (val.satisfied != null) {
                          textNode = $(this).parent().children("text").last();
                        //  delimited = textNode.text().split('|');
                        //  if (delimited[1] == null) {
                        //      textNode.text(delimited[0] + " | " + val.satisfied);
                        //  } else {
                        //      textNode.text(delimited[0] + " | " + val.satisfied);
                        //  }
                         if (val.satisfied == "SF"){
                           polygon.attr('style', "fill:#CD5360"); //red
                         } else {
                           if (val.satisfied == "ST"){
                             polygon.attr('style', "fill:#57BC90"); //green
                           } else {
                             if (val.satisfied == "SU"){
                               polygon.attr('style', "fill:#E5E338"); //yellow
                             }
                           }
                         }
                         // Check if this is a super situation. Then color the related container also
                         ssCheck = textNode.text().split('_');
                         if (ssCheck[0] == "SS") {
                           $("title").each(function(index, element){
                             ssNode = "cluster" + textNode.text().split('|')[0].trim();
                             if ($(this).text() == ssNode) {
                               polygonSS = $(this).parent().children("polygon").first();
                              //  textNodeSS = $(this).parent().children("text").last();
                              //  delimited = textNodeSS.text().split('|');
                              //  if (delimited[1] == null) {
                              //      textNodeSS.text(delimited[0] + " | " + val.satisfied);
                              //  } else {
                              //      textNodeSS.text(delimited[0] + " | " + val.satisfied);
                              //  }
                               if (val.satisfied == "SF"){
                                 polygonSS.attr('style', "fill:#CD5360"); //red
                               } else {
                                 if (val.satisfied == "ST"){
                                   polygonSS.attr('style', "fill:#57BC90"); //green
                                 } else {
                                   if (val.satisfied == "SU"){
                                     polygonSS.attr('style', "fill:#E5E338"); //yellow
                                   }
                                 }
                               }
                             }
                           });
                         }
                       } else {  // Handle the Norm Comliance value and related display text
                         if (val.compliance != null){
                           textNodeNorm = $(this).parent().children("g").first().children("a").first().children("text").first();
                           var delimited = textNodeNorm.text().split('|');
                           if (delimited[1] == null) {
                               textNodeNorm.text(delimited[0] + " | " + val.compliance);
                           } else {
                               textNodeNorm.text(delimited[0] + " | " + val.compliance);
                           }
                         }
                       }
                    }
                  });
              }
          });
        }

        //SVG click event response function
        $("#mainsvg").click(
            function(event) {

                var _id = "";
                var _text = "";
                // Get the ID from the title of the clicked element
                if ($(event.target).parent().children("title").first().text() != "") {
                    _id = $(event.target).parent().children("title").first().text();
                    _text = $(event.target).parent().children("text").first().text();

                } else {
                    _id = $(event.target).parent().parent().children("title").first().text();
                    _text = $(event.target).parent().parent().children("text").first().text();
                }

                //Allow clicking on text to select the sibling polygon
                if ($(event.target).attr('points') == null) {
                    polygon = $(event.target).parent().children("polygon").first();
                } else {
                    polygon = $(event.target);
                }

                //check if norm
                var delimited = polygon.parent().children("title").last().text().split('_');
                var isNorm = false;
                if (delimited[1] == null) {
                    isNorm = true; // Is a norm
                } else {
                    isNorm = false; // not a norm
                }

                // Don't color anything that is not polygon with points. Also don't color graphs and Norms
                if ((polygon.attr('points') != null) & (polygon.parent().children("title").first().text() != "G") & !(isNorm)) {
                    if (polygon.attr('style') == "fill:#57BC90") { // if green then turn red
                        polygon.attr('style', "fill:#CD5360"); //red
                        // var delimited = polygon.parent().children("text").last().text().split('|');
                        // if (delimited[1] == null) {
                        //     polygon.parent().children("text").last().text(delimited[0] + " | SF");
                        // } else {
                        //     polygon.parent().children("text").last().text(delimited[0] + " | SF");
                        // }
                        updateJSON(_id, "SF");
                        $("text").each(function(index, element) {
                          if (($( this ).text() != "and") && ($( this ).text() != "or") && ($( this ).text() != "not")){
                            if ($( this ).text() == _text){
                              _twinpolygon = $( this ).parent().children("polygon").first();
                              _twinpolygon.attr('style', "fill:#CD5360");
                              _twinid = $( this ).parent().children("title").first().text();
                              updateJSON(_twinid, "SF");
                            }
                          }
                        });


                    } else {
                        if (polygon.attr('style') == "fill:#CD5360") { //if red then turn yellow
                            polygon.attr('style', "fill:#E5E338"); //Yellow

                            // var delimited = polygon.parent().children("text").last().text().split('|');
                            // if (delimited[1] == null) {
                            //     polygon.parent().children("text").last().text(delimited[0] + " | SU");
                            // } else {
                            //     polygon.parent().children("text").last().text(delimited[0] + " | SU");
                            // }

                            updateJSON(_id, "SU");

                            $("text").each(function(index, element) {
                              if (($( this ).text() != "and") && ($( this ).text() != "or") && ($( this ).text() != "not")){
                                if ($( this ).text() == _text){
                                  _twinpolygon = $( this ).parent().children("polygon").first();
                                  _twinpolygon.attr('style', "fill:#E5E338");
                                  _twinid = $( this ).parent().children("title").first().text();
                                  updateJSON(_twinid, "SU");
                                }
                              }

                            });


                        } else {
                            if (polygon.attr('style') == "fill:#E5E338") { //if yellow then turn white
                                polygon.attr('style', "fill:#FFFFFF"); //white
                                updateJSON(_id, "");
                                $("text").each(function(index, element) {
                                  if (($( this ).text() != "and") && ($( this ).text() != "or") && ($( this ).text() != "not")){
                                    if ($( this ).text() == _text){
                                      _twinpolygon = $( this ).parent().children("polygon").first();
                                      _twinpolygon.attr('style', "fill:#FFFFFF");
                                      _twinid = $( this ).parent().children("title").first().text();
                                      updateJSON(_twinid, "");
                                    }
                                  }


                                });
                                // var delimited = polygon.parent().children("text").last().text().split('|');
                                // if (delimited[1] == null) {
                                //     polygon.parent().children("text").last().text(delimited[0]);
                                // } else {
                                //     polygon.parent().children("text").last().text(delimited[0]);
                                // }
                            } else { //turn green
                                polygon.attr('style', "fill:#57BC90"); //Green
                                // var delimited = polygon.parent().children("text").last().text().split('|');
                                // if (delimited[1] == null) {
                                //     polygon.parent().children("text").last().text(delimited[0] + " | ST");
                                // } else {
                                //     polygon.parent().children("text").last().text(delimited[0] + " | ST");
                                // }
                                updateJSON(_id, "ST");
                                $("text").each(function(index, element) {
                                  if (($( this ).text() != "and") && ($( this ).text() != "or") && ($( this ).text() != "not")){
                                    if ($( this ).text() == _text){
                                      _twinpolygon = $( this ).parent().children("polygon").first();
                                      _twinpolygon.attr('style', "fill:#57BC90");
                                      _twinid = $( this ).parent().children("title").first().text();
                                      updateJSON(_twinid, "ST");
                                    }
                                  }
                                });
                            }
                        }
                    }
                }
                //If this is a norm and not a graph, we set its compliance values
                if (isNorm & (polygon.parent().children("title").first().text() != "G")) {
                    var delimited = polygon.parent().children("text").last().text().split('|');
                    if (delimited[1] == null) {
                        polygon.parent().children("text").last().text(delimited[0] + " | COM");
                        updateJSON(_id, "COM");
                    } else {
                        if (delimited[1].trim() == "COM") {
                            polygon.parent().children("text").last().text(delimited[0] + " | TOL");
                            updateJSON(_id, "TOL");
                        } else {
                            if (delimited[1].trim() == "TOL") {
                                polygon.parent().children("text").last().text(delimited[0] + " | VIO");
                                updateJSON(_id, "VIO");
                            } else {
                                if (delimited[1].trim() == "VIO") {
                                    polygon.parent().children("text").last().text(delimited[0] + " | INC");
                                    updateJSON(_id, "INC");
                                } else {
                                    polygon.parent().children("text").last().text(delimited[0].trim());
                                    updateJSON(_id, "");
                                }
                            }
                        }

                    }

                }
            }
        );
    </script>
    <script>
        $(function() {
            $(document).tooltip({
                track: true,
                position: {
                    my: "center bottom-20",
                    at: "center top",
                    using: function(position, feedback) {
                        $(this).css(position);
                    }
                }
            });
        });
    </script>
    <style>
        .ui-tooltip {
            width: 300px;
            background: yellow;
            border: 2px solid red;
            padding: 10px 20px;
            font: bold 14px "Helvetica Neue", Sans-Serif;
            color: black;
            border-radius: 20px;
            box-shadow: 0 0 7px black;
        }

        .button {
            background-color: #4CAF50;
            /* Green */
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            border-radius: 8px;
        }

        textarea {
            height: 28px;
            width: 400px;
        }

        #textarea {
            -moz-appearance: textfield-multiline;
            -webkit-appearance: textarea;
            border: 1px solid gray;
            font: medium -moz-fixed;
            font: -webkit-small-control;
            height: 100px;
            overflow: auto;
            padding: 2px;
            resize: both;
            width: 800px;
        }
    </style>
</body>

</html>
